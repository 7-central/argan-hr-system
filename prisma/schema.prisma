generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Admin users who manage the HR system
model Admin {
  id           String      @id @default(uuid())
  email        String      @unique
  passwordHash String      @map("password_hash")
  name         String
  role         AdminRole   @default(ADMIN)
  isActive     Boolean     @default(true) @map("is_active")
  createdAt    DateTime    @default(now()) @map("created_at")
  updatedAt    DateTime    @updatedAt @map("updated_at")

  // Rate Limiting
  failedLoginAttempts Int      @default(0) @map("failed_login_attempts")
  lastFailedAttempt   DateTime? @map("last_failed_attempt")
  lockedUntil         DateTime? @map("locked_until")

  // Relations
  createdClients Client[]  @relation("ClientCreator")

  @@index([email])
  @@index([isActive])
  @@map("admins")
}

// HR consultancy clients (companies)
model Client {
  id                  String        @id @default(uuid())

  // Business Info
  companyName         String        @map("company_name")
  businessId          String?       @map("business_id")
  sector              String?

  // Service Classification
  serviceTier         ServiceTier   @map("service_tier")
  monthlyRetainer     Decimal?      @map("monthly_retainer") @db.Decimal(10, 2)

  // Primary Contact
  contactName         String        @map("contact_name")
  contactEmail        String        @map("contact_email")
  contactPhone        String?       @map("contact_phone")

  // Contract
  contractStartDate   DateTime?     @map("contract_start_date") @db.Date
  contractRenewalDate DateTime?     @map("contract_renewal_date") @db.Date

  // Status
  status              ClientStatus  @default(ACTIVE)

  // Metadata
  createdBy           String?       @map("created_by")
  createdByAdmin      Admin?        @relation("ClientCreator", fields: [createdBy], references: [id])
  createdAt           DateTime      @default(now()) @map("created_at")
  updatedAt           DateTime      @updatedAt @map("updated_at")

  @@index([status])
  @@index([serviceTier])
  @@index([companyName])
  @@map("clients")
}

// Enums
enum AdminRole {
  SUPER_ADMIN
  ADMIN
  VIEWER
}

enum ServiceTier {
  TIER_1    @map("tier_1")
  DOC_ONLY  @map("doc_only")
  AD_HOC    @map("ad_hoc")
}

enum ClientStatus {
  ACTIVE    @map("active")
  INACTIVE  @map("inactive")
  PENDING   @map("pending")
}
